# 日志脱敏工具 GUI 版本

基于 Electron 的图形界面日志脱敏工具，提供直观易用的拖拽式操作体验。

## 功能特性

### 🎯 **核心功能**
- **拖拽操作**：支持直接拖拽文件到界面进行处理
- **批量处理**：同时处理多个日志文件
- **实时进度**：显示详细的处理进度和统计信息
- **可视化配置**：图形化的脱敏规则设置界面
- **结果预览**：处理完成后的详细结果展示

### 🔒 **脱敏能力**
- **中国手机号**：自动识别并脱敏 11 位手机号
- **邮箱地址**：标准邮箱格式脱敏
- **身份证号**：18 位身份证号码脱敏
- **银行卡号**：12-19 位银行卡号脱敏
- **JWT 令牌**：三段式 JWT 令牌脱敏
- **敏感关键词**：password、token、secret 等关键词值脱敏
- **自定义规则**：支持用户自定义脱敏规则

### 💻 **用户体验**
- **现代化界面**：简洁美观的用户界面
- **深色主题**：支持浅色/深色主题切换
- **响应式设计**：适应不同窗口大小
- **错误处理**：友好的错误提示和处理
- **配置持久化**：自动保存用户配置

## 项目结构

```
Log-Scrubber-GUI/
├── package.json              # 项目配置
├── main.js                   # Electron 主进程
├── src/
│   ├── core/                 # 核心处理逻辑
│   │   ├── config.js         # 配置管理
│   │   ├── scrubber.js       # 脱敏引擎
│   │   └── processor.js      # 文件处理器
│   ├── renderer/             # 渲染进程（UI）
│   │   ├── index.html        # 主界面
│   │   ├── styles/           # 样式文件
│   │   │   ├── main.css      # 主样式
│   │   │   └── components.css # 组件样式
│   │   ├── scripts/          # 脚本文件
│   │   │   ├── app.js        # 主应用逻辑
│   │   │   ├── config-panel.js # 配置面板
│   │   │   └── progress.js   # 进度管理
│   │   └── components/       # UI 组件
│   │       ├── drag-drop.js  # 拖拽组件
│   │       ├── file-list.js  # 文件列表
│   │       └── settings.js   # 设置组件
│   └── preload.js           # 预加载脚本
└── assets/                  # 资源文件
    └── icons/               # 应用图标
```

## 安装和运行

### 环境要求
- Node.js >= 18.0.0
- npm 或 yarn

### 安装依赖
```bash
cd Log-Scrubber-GUI
npm install
```

### 运行应用
```bash
# 开发模式（带调试工具）
npm run dev

# 正常运行
npm start
```

### 构建可执行文件
```bash
# 构建所有平台
npm run build

# 构建特定平台
npm run build:win    # Windows
npm run build:mac    # macOS
npm run build:linux  # Linux
```

## 使用指南

### 1. 添加文件
- **拖拽方式**：直接将日志文件拖拽到中央区域
- **选择方式**：点击"选择文件"按钮选择单个或多个文件
- **支持格式**：.log、.txt 等文本文件

### 2. 配置脱敏规则
在右侧配置面板中：
- **脱敏规则**：勾选需要启用的脱敏模式
- **输出设置**：配置输出文件后缀和目录
- **高级选项**：设置并发数、编码格式等

### 3. 开始处理
- 点击底部"开始处理"按钮
- 实时查看处理进度和统计信息
- 支持暂停和取消操作

### 4. 查看结果
- 处理完成后自动显示结果摘要
- 可以直接打开输出文件夹
- 支持导出处理日志

## 界面预览

### 主界面
```
┌─────────────────────────────────────────────────────────────┐
│  日志脱敏工具 v1.0                                    [设置][帮助] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐  ┌─────────────────────────────────┐   │
│  │   文件列表      │  │                                 │   │
│  │                 │  │        拖拽区域                 │   │
│  │ ✓ app.log       │  │                                 │   │
│  │ ⚠ error.log     │  │   将日志文件拖拽到此处          │   │
│  │ ⏳ access.log    │  │        或点击选择文件           │   │
│  │                 │  │                                 │   │
│  │ [选择文件]      │  │     [选择文件] [选择文件夹]     │   │
│  │ [清空列表]      │  │                                 │   │
│  └─────────────────┘  └─────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                    配置面板                             │ │
│  │ 脱敏规则: ☑手机号 ☑邮箱 ☑身份证 ☑银行卡 ☑JWT令牌      │ │
│  │ 输出设置: 后缀[.masked.log] 目录[同源文件]              │ │
│  │ 高级选项: 并发数[4] 编码[UTF-8] ☑跳过二进制文件        │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 进度: ████████████████████████████████████████████ 100%     │
│ 状态: 处理完成 - 共处理 3 个文件，脱敏 1,234 行            │
│                                    [开始处理] [暂停] [取消] │
└─────────────────────────────────────────────────────────────┘
```

## 配置说明

### 脱敏规则配置
```javascript
{
  "patterns": [
    {
      "name": "chinese_phone",
      "description": "中国手机号",
      "enabled": true
    },
    {
      "name": "email",
      "description": "邮箱地址",
      "enabled": true
    }
    // ... 更多规则
  ],
  "outputSuffix": ".masked.log",
  "concurrency": 4,
  "encoding": "utf8"
}
```

### 输出设置
- **文件后缀**：默认 `.masked.log`
- **输出目录**：默认与源文件同目录
- **文件编码**：支持 UTF-8、GBK、GB2312 等

### 高级选项
- **并发数**：1-16，默认 4
- **跳过二进制文件**：自动检测并跳过二进制文件
- **最大文件大小**：默认 10GB 限制

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+O` | 选择文件 |
| `Ctrl+S` | 保存配置 |
| `F5` | 开始处理 |
| `Esc` | 取消/关闭对话框 |
| `Ctrl+,` | 打开设置 |

## 性能特性

### 内存优化
- **流式处理**：逐行读取，内存使用恒定
- **并发控制**：可配置的文件并发处理数
- **垃圾回收**：及时释放不需要的资源

### 处理能力
- **大文件支持**：支持 GB 级别文件处理
- **高速处理**：现代硬件上约 100MB/s
- **错误恢复**：单行错误不影响整体处理

## 错误处理

### 常见问题
1. **文件无法打开**
   - 检查文件权限
   - 确认文件未被其他程序占用

2. **处理速度慢**
   - 降低并发数
   - 检查磁盘空间和性能

3. **内存不足**
   - 减少同时处理的文件数量
   - 关闭其他占用内存的程序

### 日志查看
- 应用日志保存在用户数据目录
- 可通过"帮助" -> "打开日志目录"查看
- 支持导出处理日志

## 开发说明

### 技术栈
- **Electron**：跨平台桌面应用框架
- **Node.js**：后端处理逻辑
- **HTML/CSS/JavaScript**：前端界面
- **IPC**：进程间通信

### 开发模式
```bash
# 启动开发模式（带调试工具）
npm run dev

# 热重载（需要安装 electron-reload）
npm install --save-dev electron-reload
```

### 调试
- 开发模式下自动打开 DevTools
- 主进程日志在终端查看
- 渲染进程日志在 DevTools Console 查看

### 构建配置
构建配置在 `package.json` 的 `build` 字段中：
```json
{
  "build": {
    "appId": "com.logscrubber.gui",
    "productName": "Log Scrubber",
    "directories": {
      "output": "dist"
    },
    "files": [
      "main.js",
      "src/**/*",
      "assets/**/*",
      "package.json"
    ]
  }
}
```

## 更新日志

### v1.1.0 (2025-12-26)
- 修复取消/异常路径 ReferenceError 崩溃问题
- 修复 URL query 参数脱敏"吞参"问题
- 修复 JSON 结构化日志按敏感键脱敏
- 修复配置面板 UI 回显（enableMasking/maskUrlParams）
- 修复配置导入/导出自洽性（白名单字段补齐）
- 修复 JSON 无变化时重新序列化问题
- 修复临时文件清理策略（原子写入 + 历史遗留清理）
- 完善路径安全校验（Windows 敏感目录 + 路径遍历检测）
- 移除未使用的 sharp 依赖
- 升级 Electron 到稳定版本

### v1.0.0 (2024-12-15)
- 🎉 初始版本发布
- ✨ 支持拖拽文件处理
- ✨ 可视化配置界面
- ✨ 实时进度显示
- ✨ 深色主题支持
- ✨ 批量文件处理
- ✨ 详细结果统计

## 许可证

MIT License - 详见 [LICENSE](../LICENSE) 文件

## 贡献

欢迎提交 Issue 和 Pull Request！

### 开发流程
1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 支持

- 📧 邮箱：hmym0604@outlook.com
- 🐛 问题反馈：[GitHub Issues](https://github.com/log-scrubber/gui/issues)
- 📖 文档：[在线文档](https://docs.logscrubber.com)

---

**注意**：本工具仅用于合法的日志脱敏需求，请遵守相关法律法规和数据保护条例。